<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- 报告模块 -->
<mapper namespace="com.news.dao.AppStatisticsDao">

    <!-- 添加报告 -->
    <insert id="addReport">
        insert into report
        (appId, createTime, lookPV, clickNum, clickProbability, income, ecmp) values
        <foreach collection="list" index="index" item="item" open="" close="" separator=",">
            (#{item.appId},#{item.createTime},#{item.lookPV},#{item.clickNum},#{item.clickProbability},#{item.income},#{item.ecmp})
        </foreach>
    </insert>

    <!-- 查询报告列表 -->
    <select id="reportList" parameterType="java.util.Map" resultType="com.news.vo.AppStatisticsListVo">
        SELECT DATE_FORMAT(r.createTime,"%Y-%m-%d")as createTime,r.*,a.appName
        from report r,app a,user u
        where r.appId = a.appId and a.userId = u.userId
        <if test="appId != null and appId !=''">
            and a.appId = #{appId}
        </if>
        <if test="appName != null and appName !=''">
            and a.appName = #{appName}
        </if>
        <if test="currentUserLevel == 2">
            and u.parentId = #{parentId}
        </if>
        <if test="currentUserLevel == 3">
            and a.userId = #{parentId}
        </if>
        order by r.reportId asc
        limit #{num},#{pageSize}
    </select>

    <!-- 查询报告列表数量 -->
    <select id="reportListNum" parameterType="java.util.Map" resultType="java.lang.Integer">
        SELECT count(0)
        from report r,app a,user u
        where r.appId = a.appId and a.userId = u.userId
        <if test="appId != null and appId !=''">
            and a.appId = #{appId}
        </if>
        <if test="appName != null and appName !=''">
            and a.appName = #{appName}
        </if>
        <if test="currentUserLevel == 2">
            and u.parentId = #{parentId}
        </if>
        <if test="currentUserLevel == 3">
            and a.userId = #{parentId}
        </if>
    </select>

</mapper>